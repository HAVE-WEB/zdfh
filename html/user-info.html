<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>修改个人信息</title>

    <!-- Set render engine for 360 browser -->
    <meta name="renderer" content="webkit">

    <!-- No Baidu Siteapp-->
    <meta http-equiv="Cache-Control" content="no-siteapp"/>

    <link rel="icon" type="image/png" href="i/favicon.png">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="i/app-icon72x72@2x.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
    <link rel="apple-touch-icon-precomposed" href="i/app-icon72x72@2x.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="i/app-icon72x72@2x.png">
    <meta name="msapplication-TileColor" content="#0e90d2">

    <!-- Amaze UI CSS -->
    <link rel="stylesheet" href="../assets/css/amazeui.css">
    <link rel="stylesheet" href="../assets/css/sl.css">
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/amazeui.js"></script>
    <link rel="stylesheet" href="../assets/css/picker.css">
    <script src="../assets/js/picker.js"></script>
    <script src="../assets/js/data/city.js"></script>
    <script src="../assets/js/data/hospitalLeave.js"></script>
    <script src="../assets/js/data/hospitalOffice.js"></script>
    <script src="../assets/js/data/education.js"></script>
    <style>
        input:focus{
            outline: none;
        }
    </style>
</head>
<body>

<form class="am-form ">
    <fieldset>

        <div class="am-g sl-flex-row-center-center sl-font-size-16px sl-padding-0px">
            <div class="am-u-sm-12 am-u-md-12 am-u-lg-12 sl-flex-row-center-center" >
                <img src="../assets/images/car.png" alt="" style="width: 30%;height: 30%">
            </div>
        </div>

        <!--<div class=" sl-flex-column-center-center sl-font-size-16px " >-->
            <!--<div class="sl-flex-row-center-space-between am-g sl-background-color-white">-->
                <!--<div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-flex-start sl-padding-0px" >-->
                    <!--<span>姓名:</span>-->
                <!--</div>-->
                <!--<div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">-->
                    <!--<input type="text" placeholder="请输入姓名" name="userName" >-->
                <!--</div>-->
            <!--</div>-->
            <!--<hr style="margin: 0px; border-top: 1px solid #CCCCCC;width: 80%;"/>-->
        <!--</div>-->


        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                <span>姓名:</span>
            </div>
            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                <input type="text" placeholder="请输入姓名"  >
            </div>
        </div>

        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                <span>联系地址:</span>
            </div>
            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                <input type="text" placeholder="请选择联系地址" onclick="pickerAddress()" name="address" id="address" >
            </div>
        </div>


        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-padding-0px" >
                <span>医院:</span>
            </div>
            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 sl-flex-row-center-flex-start">
                <input type="text" placeholder="请输入医院" name="hospital" style="width:70%" id="hospital">
                <a class="sl-margin-left-10px sl-background-color-FFCCCC sl-font-color-FF6666 sl-padding-2px-5px" href="hospitalSearch.html">选 择</a>
            </div>
        </div>

        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                <span>等级:</span>
            </div>
            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                <input type="text" placeholder="请选择等级" onclick="pickerHospitalLevel()" name="hospitalLevel" id="hospitalLevel" >
            </div>
        </div>

        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                <span>科室:</span>
            </div>
            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                <input type="text" placeholder="请选择科室" onclick="pickerHospitalOffice()" name="hospitalOffice" id="hospitalOffice" >
            </div>
        </div>

        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                <span>职务:</span>
            </div>
            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                <input type="text" placeholder="请输入职务"  >
            </div>
        </div>

        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                <span>身份证:</span>
            </div>
            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                <input type="text" placeholder="请输入身份证">
            </div>
        </div>

        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                <span>品种:</span>
            </div>
            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                <div class="">
                    <label class="am-checkbox-inline">
                        <input type="checkbox"  value="" data-am-ucheck> iPhone
                    </label>
                    <label class="am-checkbox-inline">
                        <input type="checkbox"  value="" data-am-ucheck> iMac
                    </label>
                    <label class="am-checkbox-inline">
                        <input type="checkbox"  value="" data-am-ucheck> Macbook
                    </label>
                </div>
            </div>
        </div>

        <ul class="am-list admin-sidebar-list" id="collapase-nav-1">
            <li class="am-panel">
                <a data-am-collapse="{parent: '#collapase-nav-1', target: '#user-nav'}">
                    <i class="am-icon-users am-margin-left-sm"></i> 显示更多 <i class="am-icon-angle-right am-fr am-margin-right"></i>
                </a>
                <ul class="am-list am-collapse admin-sidebar-sub" id="user-nav">
                    <li>
                        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
                            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                                <span>品种认知态度</span>
                            </div>
                            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                                <input type="text" placeholder="请输入品种认知态度">
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
                            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                                <span>学历背景</span>
                            </div>
                            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                                <input type="text" placeholder="请选择学历背景" onclick="pickerEducation()" id="education">
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
                            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                                <span>社会职务</span>
                            </div>
                            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                                <input type="text" placeholder="请输入社会职务">
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
                            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                                <span>兴趣</span>
                            </div>
                            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                                <input type="text" placeholder="请输入兴趣">
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
                            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                                <span>党派</span>
                            </div>
                            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                                <input type="text" placeholder="请输入党派">
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
                            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                                <span>宗教信仰</span>
                            </div>
                            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                                <input type="text" placeholder="请输入宗教信仰">
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
                            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                                <span>家庭状态</span>
                            </div>
                            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                                <input type="text" placeholder="请输入家庭状态">
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
                            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                                <span>学术分级</span>
                            </div>
                            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                                <input type="text" placeholder="请选择学术分级" onclick="pickerEducation()" >
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
                            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                                <span>销售分级</span>
                            </div>
                            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                                <input type="text" placeholder="请选择销售分级" onclick="pickerEducation()">
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="am-g sl-flex-row-center-center sl-margin-top-10px">
                            <div class="am-u-sm-3 am-u-md-3 am-u-lg-3 sl-flex-row-center-center sl-font-size-16px sl-padding-0px" >
                                <span>销售等级</span>
                            </div>
                            <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 ">
                                <input type="text" placeholder="请选择销售等级" onclick="pickerEducation()" >
                            </div>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>

        <button type="submit" class="am-btn am-btn-default am-btn-warning" style="position: fixed;top: 0px;" id="user-Info-btn">提交</button>
    </fieldset>
</form>
<input type="file" name="image" accept=“image/*” onchange='handleInputChange'>

<!--<div class="am-modal am-modal-alert" tabindex="-1" id="selectAddress">-->
    <!--<div class="am-modal-dialog">-->
        <!--<div class="am-modal-hd">提示信息</div>-->
        <!--<div class="am-modal-bd">-->
            <!--请选择地址-->
        <!--</div>-->
        <!--<div class="am-modal-footer">-->
            <!--<span class="am-modal-btn">确定</span>-->
        <!--</div>-->
    <!--</div>-->
<!--</div>-->
</body>
<script>
    $(document).ready(function () {
        var p=location.host;
        console.log("p:"+p)

        var w_window = window.innerWidth;
        var ow = $("#user-Info-btn").outerWidth();
        $("#user-Info-btn").css("left",(w_window - ow)+"px");

        //获取URL的参数
        var name = "result";
        var locationSearch = decodeURI(location.search);
        if(locationSearch.indexOf(name) != -1){
                var pos_start = locationSearch.indexOf(name)+name.length+1;
                var pos_end = locationSearch.indexOf("&",pos_start);
        }
        if(pos_end ==  -1){
            var hos = locationSearch.substr(pos_start)
            $("#hospital").val(hos);
        }
//        var arrPar = locationSearch.split("?");
//        alert(arrPar)
       // alert(locationSearch);
    })
    //选择省市区控件
    function pickerAddress() {
        var address = document.getElementById('address');
        new Picker({
            "title": '请选择',//标题(可选)
            "defaultValue": address.value,//默认值-多个以空格分开（可选）
            "data": cityData,//数据(必传)
            "keys": {
                "id": "Code",
                "value": "Name",
                "childData": "level"//最多3级联动
            },//数组内的键名称(必传，id、text、data)
            "callBack": function (val) {
                //回调函数（val为选择的值）
                address.value = val;
            }
        });
    }
    //选择等级
    function pickerHospitalLevel() {
        var hospitalLevel = document.getElementById('hospitalLevel');
        new Picker({
            "title": '请选择',//标题(可选)
            "defaultValue": hospitalLevel.value,//默认值（可选）
            "type": 1,//需要联动级数[1、2、3]（可选、不传时默认获取数据的深度,最多3级）
            "data": levelData,//数据(必传)
            "keys": {
                "id": "Code",
                "value": "Name",
                "childData": "level"//最多3级联动
            },//数组内的键名称(必传，id、text、data)
            "callBack": function (val) {
                //回调函数（val为选择的值）
                hospitalLevel.value = val;
            }
        });
    };
    //选择科室
    function pickerHospitalOffice() {
        var hospitalOffice = document.getElementById('hospitalOffice');
        new Picker({
            "title": '请选择',//标题(可选)
            "defaultValue": hospitalOffice.value,//默认值（可选）
            "type": 1,//需要联动级数[1、2、3]（可选、不传时默认获取数据的深度,最多3级）
            "data": officeData,//数据(必传)
            "keys": {
                "id": "Code",
                "value": "Name",
                "childData": "level"//最多3级联动
            },//数组内的键名称(必传，id、text、data)
            "callBack": function (val) {
                //回调函数（val为选择的值）
                hospitalOffice.value = val;
            }
        });
    };
    //选择科室
    function pickerEducation() {
        var education = document.getElementById('education');
        new Picker({
            "title": '请选择',//标题(可选)
            "defaultValue": education.value,//默认值（可选）
            "type": 1,//需要联动级数[1、2、3]（可选、不传时默认获取数据的深度,最多3级）
            "data": educationData,//数据(必传)
            "keys": {
                "id": "Code",
                "value": "Name",
                "childData": "level"//最多3级联动
            },//数组内的键名称(必传，id、text、data)
            "callBack": function (val) {
                //回调函数（val为选择的值）
                education.value = val;
            }
        });
    };
    $("#user-Info-btn").click(function () {
        history.go(-1);

    })


    //选择按钮的click事件
    $("#search-hospital").click(function () {
        var val = $("#address").val();
//        if(val ===  ""){
//            alert("请选择联系地址")
//            location.reload();
//        }else{
          location.href="hospitalSearch.html";
//        }
    })


    //上传图片
    // 全局对象，不同function使用传递数据
    const imgFile = {};

    function handleInputChange (event) {
        // 获取当前选中的文件
        const file = event.target.files[0];
        const imgMasSize = 1024 * 1024 * 10; // 10MB

        // 检查文件类型
        if(['jpeg', 'png', 'gif', 'jpg'].indexOf(file.type.split("/")[1]) < 0){
            // 自定义报错方式
            // Toast.error("文件类型仅支持 jpeg/png/gif！", 2000, undefined, false);
            return;
        }

        // 文件大小限制
        if(file.size > imgMasSize ) {
            // 文件大小自定义限制
            // Toast.error("文件大小不能超过10MB！", 2000, undefined, false);
            return;
        }

        // 判断是否是ios
        if(!!window.navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){
            // iOS
            transformFileToFormData(file);
            return;
        }

        // 图片压缩之旅
        transformFileToDataUrl(file);
    }
    // 将File append进 FormData
    function transformFileToFormData (file) {
        const formData = new FormData();
        // 自定义formData中的内容
        // type
        formData.append('type', file.type);
        // size
        formData.append('size', file.size || "image/jpeg");
        // name
        formData.append('name', file.name);
        // lastModifiedDate
        formData.append('lastModifiedDate', file.lastModifiedDate);
        // append 文件
        formData.append('file', file);
        // 上传图片
        uploadImg(formData);
    }
    // 将file转成dataUrl
    function transformFileToDataUrl (file) {
        const imgCompassMaxSize = 200 * 1024; // 超过 200k 就压缩

        // 存储文件相关信息
        imgFile.type = file.type || 'image/jpeg'; // 部分安卓出现获取不到type的情况
        imgFile.size = file.size;
        imgFile.name = file.name;
        imgFile.lastModifiedDate = file.lastModifiedDate;

        // 封装好的函数
        const reader = new FileReader();

        // file转dataUrl是个异步函数，要将代码写在回调里
        reader.onload = function(e) {
            const result = e.target.result;

            if(result.length < imgCompassMaxSize) {
                compress(result, processData, false );    // 图片不压缩
            } else {
                compress(result, processData);            // 图片压缩
            }
        };

        reader.readAsDataURL(file);
    }
    // 使用canvas绘制图片并压缩
    function compress (dataURL, callback, shouldCompress = true) {
        const img = new window.Image();

        img.src = dataURL;

        img.onload = function () {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            canvas.width = img.width;
            canvas.height = img.height;

            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            let compressedDataUrl;

            if(shouldCompress){
                compressedDataUrl = canvas.toDataURL(imgFile.type, 0.2);
            } else {
                compressedDataUrl = canvas.toDataURL(imgFile.type, 1);
            }

            callback(compressedDataUrl);
        }
    }

    function processData (dataURL) {
        // 这里使用二进制方式处理dataUrl
        const binaryString = window.atob(dataUrl.split(',')[1]);
        const arrayBuffer = new ArrayBuffer(binaryString.length);
        const intArray = new Uint8Array(arrayBuffer);
        const imgFile = this.imgFile;

        for (let i = 0, j = binaryString.length; i < j; i++) {
            intArray[i] = binaryString.charCodeAt(i);
        }

        const data = [intArray];

        let blob;

        try {
            blob = new Blob(data, { type: imgFile.type });
        } catch (error) {
            window.BlobBuilder = window.BlobBuilder ||
                window.WebKitBlobBuilder ||
                window.MozBlobBuilder ||
                window.MSBlobBuilder;
            if (error.name === 'TypeError' && window.BlobBuilder){
                const builder = new BlobBuilder();
                builder.append(arrayBuffer);
                blob = builder.getBlob(imgFile.type);
            } else {
                // Toast.error("版本过低，不支持上传图片", 2000, undefined, false);
                throw new Error('版本过低，不支持上传图片');
            }
        }

        // blob 转file
        const fileOfBlob = new File([blob], imgFile.name);
        const formData = new FormData();

        // type
        formData.append('type', imgFile.type);
        // size
        formData.append('size', fileOfBlob.size);
        // name
        formData.append('name', imgFile.name);
        // lastModifiedDate
        formData.append('lastModifiedDate', imgFile.lastModifiedDate);
        // append 文件
        formData.append('file', fileOfBlob);

        uploadImg(formData);
    }

    // 上传图片
    function uploadImg(formData){
        const xhr = new XMLHttpRequest();

        // 进度监听
        xhr.upload.addEventListener('progress', (e)=>{console.log(e.loaded / e.total)}, false);
        // 加载监听
        // xhr.addEventListener('load', ()=>{console.log("加载中");}, false);
        // 错误监听
        xhr.addEventListener('error', ()=>{Toast.error("上传失败！", 2000, undefined, false);}, false);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                const result = JSON.parse(xhr.responseText);
                if (xhr.status === 200) {
                    // 上传成功


                } else {
                    // 上传失败
                }
            }
        };
        xhr.open('POST', '/uploadUrl' , true);
        xhr.send(formData);
    }

</script>
</html>